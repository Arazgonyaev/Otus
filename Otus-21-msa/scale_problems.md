# Узкие места и проблемы масштабирования

## 1. Проверка валидности токена аутентификации
Изначально в системе использовался симметричный алгоритм шифрования, каждое
обращение к системе приводило к вызову сервиса аутентификации для проверки
валидности токена. Это создавало дополнительную нагрузку на сервис аутентификации,
вносило задержку в обработку всех запросов.

**Решение:** агоритм шифрования изменен на несимметричный, приватный ключ
хранится только в сервисе аутентификации, данные для проверки токена (включая 
публичный ключ) могут быть получены из сервиса аутентификации для самостоятельной
проверки валидности токена. Проверка валидности токена перенесена в API-шлюз,
который один раз получает данные для валидации токена из сервиса аутентификации.

## 2. Масштабирование БД сервиса пользователей
С ростом клинтской базы возникла необходимость масштабирования сервиса
пользователей. Отдельные экземпляры сервиса обращаются к одной и той же БД
пользователей, но наличие единой БД приводит к следующим проблемам:
1. быстрый рост БД, в частности, в связи с тем, что сообщения личного кабинета
хранятся в БД пользователей;
2. долгий отклик при загрузке стартовой страницы для клиентов, находящихся 
на большом удалении от БД.

**Решение:** применение шардирования БД пользователей, при этом ключом
шардирования будет являться континент пользователя. Для каждого пользователя
на основании статистики принадлежности IP-адреса будет выбираться домашний
континент. Для наиболее загруженных континентов будет выделены отдельные БД
пользователей, размещены в ЦОД этих континентов, там же будут размещены
экземпляры сервиса пользовавтелей.